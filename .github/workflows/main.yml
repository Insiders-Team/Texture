## Action Name
name: "ðŸ”ƒ CI/CD - Auto-update"

## Trigger
on:
  workflow_dispatch:
  push:
    paths:
      - "texture/unzipped/java"
      - "texture/unzipped/bedrock"
    branches: ["main"]

## Environment Variables
env:
  JAVA_FILE_NAME: "Java-Insiders.zip"
  BEDROCK_FILE_NAME: "Bedrock-Insiders.mcpack"

## Action Permissions
permissions: write-all

## Jobs
jobs:
  ## Java Edition Texture
  deploy-java:
    ## Name of the job
    name: "ðŸ”ƒ CD - Deploy Java Texture"

    ## Run on Ubuntu
    runs-on: ubuntu-latest

    ## Jobs Steps
    steps:
      ## Checkout repository
      - name: "ðŸ”ƒ CD - Checkout the repository"
        uses: actions/checkout@v3

      ## Zip the texture
      # - name: "ðŸ”ƒ CD - Zip the texture"
      #   uses: papeloto/action-zip@v1
      #   with:
      #     files: texture/unzipped/java
      #     recursive: true
      #     dest: texture/zipped/$JAVA_FILE_NAME

      - name: "ðŸ”ƒ CD - Zip the texture"
        run: |
          zip -u -ll -Z bzip2 -r ./texture/zipped/$JAVA_FILE_NAME ./texture/unzipped/java

      ## Setup the git for pushing the changes
      - name: "ðŸ”ƒ CD - Setup git credentials"
        run: |
          git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"

      ## Pre-pull to avoid errors when pushing
      - name: "ðŸ”ƒ CD - Pull changes"
        run: |
          git pull origin main

      ## Add the zipped texture
      - name: "ðŸ”ƒ CD - Add the zipped texture"
        run: |
          git add texture/zipped/$JAVA_FILE_NAME

      ## Commit the changes
      - name: "ðŸ”ƒ CD - Commit the changes"
        run: |
          git commit -m "Java: Update $JAVA_FILE_NAME"

      ## Push the current changes for the repository
      - name: "ðŸ”ƒ CD - Push the changes to the repository"
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ github.ref }}

  ## Bedrock Edition Texture
  deploy-bedrock:
    ## Name of the job
    name: "ðŸ”ƒ CI - Deploy Bedrock Texture"

    ## Run on Ubuntu
    runs-on: ubuntu-latest

    ## Jobs Steps
    steps:
      ## Checkout repository
      - name: "ðŸ”ƒ CI - Checkout the repository"
        uses: actions/checkout@v3

      ## Zip the texture
      # - name: "ðŸ”ƒ CD - Zip the texture"
      #   uses: papeloto/action-zip@v1
      #   with:
      #     files: texture/unzipped/java
      #     recursive: true
      #     dest: texture/zipped/$BEDROCK_FILE_NAME

      - name: "ðŸ”ƒ CD - Zip the texture"
        run: |
          zip -u -ll -Z bzip2 texture/zipped/$BEDROCK_FILE_NAME texture/unzipped/bedrock/*

      ## Setup the git for pushing the changes
      - name: "ðŸ”ƒ CI - Setup git credentials"
        run: |
          git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"

      ## Pre-pull to avoid errors when pushing
      - name: "ðŸ”ƒ CI - Pull changes"
        run: |
          git pull origin main

      ## Add the zipped texture
      - name: "ðŸ”ƒ CI - Add the zipped texture"
        run: |
          git add texture/zipped/$BEDROCK_FILE_NAME

      ## Commit the changes
      - name: "ðŸ”ƒ CI - Commit the changes"
        run: |
          git commit -m "Bedrock: Update $BEDROCK_FILE_NAME"

      ## Push the current changes for the repository
      - name: "ðŸ”ƒ CI - Push the changes to the repository"
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ github.ref }}
